# Accounting / 个人财务系统

以 `SYSTEM_README.md` 为蓝本的综合财务管理仓库，涵盖日常收支、账户余额、信用卡、転売项目、积分返点（POI）与库存。核心单一数据源为 `accounts/transactions.csv`，其他模块围绕该流水展开。

## 目录与核心文件
```
accounting/
├── config/              # 账户、分类、信用卡定义
├── accounts/
│   ├── transactions.csv # 【核心】所有资金流动：消费/收入/转换/转账/仕入/販売/返点
│   └── balances.csv     # 账户余额快照
├── inventory/           # 库存商品与进出记录（支撑仕入/販売）
├── poi/                 # 积分返点事件与步骤
├── business/            # 项目索引与项目级汇总
├── 2025/                # 2025 年日常消费历史 CSV（口语化输入产物）
└── SYSTEM_README.md     # 系统设计总览（权威说明）
```

## 交易模型
- **类型与资金流**：
  | 类型 | 从账户 | 到账户 | 说明 |
  |------|--------|--------|------|
  | 消费 | 有 | 空 | 日常支出 |
  | 收入 | 空 | 有 | 工资、麻将收入等 |
  | 转换 | 有 | 有 | 余额 A→余额 B（充值/换钱包）|
  | 转账 | 有 | 有 | 还信用卡、账户间转账 |
  | 仕入 | 有 | 空 | 余额→库存（进货）|
  | 販売 | 空 | 有 | 库存→余额（出货）|
  | 返点 | 空 | 有 | POI 返点到账 |

- **数据流**：账户余额 ──仕入──► 库存 ──販売──► 账户余额；转换用于账户/钱包间互转，POI 为附加收益。
- **单一来源**：所有资金流记录在 `accounts/transactions.csv`（字段：交易ID、日期、类型、从账户、到账户、金额、关联库存ID、关联事件ID、项目ID、备注）。

## 主要工作流
- **日常消费/收入**：将口语化流水标准化后写入 `accounts/transactions.csv`；2025 年的历史明细可继续放在 `2025/MM.csv` 作为补充视图。
- **転売/库存**：转换（充值）、仕入（进货）、販売（出货）均写入 `accounts/transactions.csv`；同步更新 `inventory/items.csv` 与 `inventory/movements.csv`。
- **POI 活动**：在 `poi/events.csv` 记录规则与预期，在 `poi/steps.csv` 追踪步骤与关联交易；返点到账后写入 `accounts/transactions.csv` 并更新状态。
- **项目汇总**：业务项目列表见 `business/projects/index.csv`，具体项目（如 `T202511A`）在对应子目录下维护汇总。
- **账户余额**：快照保存在 `accounts/balances.csv`，更新时注明日期。

## 编码与规范
- CSV 统一使用 UTF-8 with BOM；Markdown/代码使用 UTF-8（无 BOM）。
- 账户/分类/信用卡 ID 参考 `config/` 下的定义，保持命名一致；交易类型遵循上表，不将「转换」混淆为「仕入」。
- 币种以交易所属账户的币种为准，金额为正数；转账/转换为中性流动，返点独立记录。
- 月度文件与旧版脚本（`tools/`）主要服务 2025 日常消费记录，若继续使用请确保表头为 `日期, 类型, 分类, 金额, 币种, 账户, 商户, 备注` 且编码为 UTF-8 BOM。

## 参考
- 详细账户/信用卡列表、项目与库存/POI 现状见 `SYSTEM_README.md`。
- 业务子系统概览：`business/README.md`。
