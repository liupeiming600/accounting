# 记账规则与数据规范

以 `SYSTEM_README.md` 的交易模型为准，所有资金流以 `accounts/transactions.csv` 为单一数据源，其他表据此关联。

## 交易字段
- 字段顺序：`交易ID, 日期, 类型, 从账户, 到账户, 金额, 关联库存ID, 关联事件ID, 项目ID, 备注`。
- 金额为正数；币种由账户定义决定。
- 账户、分类、信用卡等命名请使用 `config/` 下的标准 ID（如 `CASH_JPY`, `ALIPAY`, `SUICA`, `AMEX_GOLD`, `RAKUTEN_CARD` 等）。

## 类型与口径
- **消费/收入**：日常支出与收入，单向流动。
- **转换**：余额 A→余额 B（例如充值 Apple、钱包互转）；不等同于进货。
- **转账**：还信用卡、账户间划转，亦为双向流动；在汇总时应作为中性处理。
- **仕入/販売**：库存进出，必须与 `inventory/items.csv`、`inventory/movements.csv` 保持一致，并按项目 ID 归集（如 `T202511A`）。
- **返点**：积分/返利到账，独立记录，可关联 `poi/events.csv` 与 `poi/steps.csv`。

## 数据质量要求
- 编码：CSV 统一 UTF-8 with BOM；Markdown/代码 UTF-8（无 BOM）。
- 日期：使用 `YYYY-MM-DD`；交易发生日为准。
- 同义词：保持账户/分类名称一致，不使用多种写法（例：PayPay 不写作 paypay）。
- 货币：以账户币种为准，目前主用 JPY、RMB；禁止在同一账户内混写不同币种。
- 备注：用于活动名、订单号、对账说明或分摊信息。

## 月度历史数据
- `2025/MM.csv` 仍保留口语化日常消费记录，表头为 `日期, 类型, 分类, 金额, 币种, 账户, 商户, 备注`，编码 UTF-8 BOM。
- 如需继续使用 `tools/` 下的旧版脚本处理月度文件，请先确保字段含义与主交易表一致，并避免与核心流水产生冲突。
